Содержание

--- Создание файла конфигурации (dialog)


--- Настройка сети
# Импортирование настроек из LiveCD
# Сетевой интерфейс по умолчанию
netstat -r | grep default | awk '{print $8}'
# Сетевые настройки ip,mask,bcast
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | sed -n '/inet/,/ /p'
# IP
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 inet
# Netmask
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 netmask
# broadcast
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 broadcast
# Шлюз по умолчанию
netstat -r | grep default | awk '{print $2}'

--- Подготовка дисков
# Вывод информации по дискам
parted -s --list | grep Model -A1
# генерация списка дисков (названия)
parted --list | grep Model |  awk '{print  $3, $4, $5, $6}'
# Сопославдение названия диска и ссылки на устройство


# Стандартная установка ext4
parted -a optimal $DISK mklabel gpt
parted -a optimal $DISK unit mib
parted -a optimal $DISK mkpart primary 1 3
parted -a optimal $DISK name 1 grub
parted -a optimal $DISK set 1 bios_grub on
parted -a optimal $DISK mkpart primary 3 131
parted -a optimal $DISK name 2 boot
parted -a optimal $DISK mkpart primary 131 643
parted -a optimal $DISK name 3 swap
parted -a optimal $DISK mkpart primary 643 -1
parted -a optimal $DISK name 4 rootfs
parted -a optimal $DISK set 2 boot on
# Форматирование разделов
mkfs.ext4 /dev/sda2
mkfs.ext4 /dev/sda4
# Активация swap раздела
mkswap /dev/sda3
swapon /dev/sda3
# Монтирование разделов
mount /dev/sda4 /mnt/gentoo
mkdir /mnt/gentoo/boot
mount /dev/sda2 /mnt/gentoo/boot

--- Установка установочных файлов Gentoo
cd /mnt/gentoo
# Загрузка последнего среза
 wget http://mirror.yandex.ru/gentoo-distfiles/releases/amd64/autobuilds/`links -source http://mirror.yandex.ru/gentoo-distfiles/releases/amd64/autobuilds/latest-stage3-amd64.txt | grep stage3 | awk '{print $1}'`
# Распаковка среза
tar xvjpf stage3-*.tar.bz2

--- Установка базовой системы Gentoo
# Создание /mnt/gentoo/etc/portage/make.conf
CFLAGS="-march=native -O2 -pipe"
# Use the same settings for both variables
CXXFLAGS="${CFLAGS}"
# подсчет количества потоков процессора
MAKEOPTS=$((`cat /proc/cpuinfo | grep processor | wc -l` + 1))
echo MAKEOPTS=\"-j$MAKEOPTS\"
#make.conf example
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="${CFLAGS}"
CHOST="x86_64-pc-linux-gnu"

MAKEOPTS="-j5"

LINGUAS="ru en"
USE="-ipv6 -X bindist mmx sse sse2"
ACCEPT_LICENSE="*"

PORTDIR="/usr/portage"
DISTDIR="${PORTDIR}/distfiles"
PKGDIR="${PORTDIR}/packages"

GENTOO_MIRRORS="http://mirror.yandex.ru/gentoo-distfiles/"
SYNC="rsync://mirror.yandex.ru/gentoo-portage"



--- Настройка ядра Linux


--- Настройка параметров системы


--- Установка системных средств


--- Настройка начального загрузчика


--- Завершение установки
