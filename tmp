Содержание

--- Создание файла конфигурации (dialog)


--- Настройка сети
# Импортирование настроек из LiveCD
# Сетевой интерфейс по умолчанию
netstat -rn | grep "0.0.0.0" | awk '{print $8}' |sort|uniq|grep -v lo
# Сетевые настройки ip,mask,bcast
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | sed -n '/inet/,/ /p'
# IP
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 inet | grep -v inet
# Netmask
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 netmask | grep -v netmask
# broadcast
ifconfig `netstat -rn | grep default | awk '{print $8}'` | grep inet | grep -v inet6 | grep -v "127.0.0.1" | awk -v RS=' ' '!(NR%1){gsub(/\n/," ");print} ' | grep -A 1 broadcast | grep -v netmask
# Шлюз по умолчанию
netstat -rn | awk '{print $1, $2}' | grep "0.0.0.0 " | awk '{print $2}'

--- Подготовка дисков
# генерация списка дисков
fdisk -l | grep "Disk " | grep -v identifier | grep -v loop0 | awk '{print $2, $3 $4}' | sed 's/,//g'
# Сопославдение названия диска и ссылки на устройство


# Стандартная установка ext4
parted -sa optimal /dev/sda mklabel gpt
parted -sa optimal /dev/sda unit mib
parted -sa optimal /dev/sda mkpart primary 1 3
parted -sa optimal /dev/sda name 1 grub
parted -sa optimal /dev/sda set 1 bios_grub on
parted -sa optimal /dev/sda mkpart primary 3 131
parted -sa optimal /dev/sda name 2 boot
parted -sa optimal /dev/sda mkpart primary 131 643
parted -sa optimal /dev/sda name 3 swap
parted -sa optimal /dev/sda mkpart primary 643 100%
parted -sa optimal /dev/sda name 4 rootfs
parted -sa optimal /dev/sda set 2 boot on
parted -sa optimal /dev/sda print

# Форматирование разделов
mkfs.ext4 /dev/sda2
mkfs.ext4 /dev/sda4
# Активация swap раздела
mkswap /dev/sda3
swapon /dev/sda3
# Монтирование разделов
mount /dev/sda4 /mnt/gentoo
mkdir /mnt/gentoo/boot
mount /dev/sda2 /mnt/gentoo/boot

--- Установка установочных файлов Gentoo
cd /mnt/gentoo
# Загрузка последнего среза
 wget http://mirror.yandex.ru/gentoo-distfiles/releases/amd64/autobuilds/`links -source http://mirror.yandex.ru/gentoo-distfiles/releases/amd64/autobuilds/latest-stage3-amd64.txt | grep stage3 | awk '{print $1}'`
# Распаковка среза
tar xvjpf stage3-*.tar.bz2

--- Установка базовой системы Gentoo
# Создание /mnt/gentoo/etc/portage/make.conf
CFLAGS="-march=native -O2 -pipe"
# Use the same settings for both variables
CXXFLAGS="${CFLAGS}"
# подсчет количества потоков процессора
MAKEOPTS=$((`cat /proc/cpuinfo | grep processor | wc -l` + 1))
echo MAKEOPTS=\"-j$MAKEOPTS\"
#make.conf example
CFLAGS="-march=native -O2 -pipe"
CXXFLAGS="${CFLAGS}"
CHOST="x86_64-pc-linux-gnu"

MAKEOPTS="-j5"

LINGUAS="ru en"
USE="-ipv6 -X bindist mmx sse sse2"
ACCEPT_LICENSE="*"

PORTDIR="/usr/portage"
DISTDIR="${PORTDIR}/distfiles"
PKGDIR="${PORTDIR}/packages"

GENTOO_MIRRORS="http://mirror.yandex.ru/gentoo-distfiles/"
SYNC="rsync://mirror.yandex.ru/gentoo-portage"



--- Настройка ядра Linux


--- Настройка параметров системы


--- Установка системных средств


--- Настройка начального загрузчика


--- Завершение установки
